<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Hindi Words Formation - हिन्दी शब्द रचना</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --nav-bg: #f8f9fa;
            --sidebar-bg: #ffffff;
            --selected-item: #0f0f0f;
            --selected-text: #889487;
            --correct-item-bg: #98FB98;
            --border-color: #dee2e6;
            --hover-color: #007bff;
            --secondary-bg-color: #f5f5f5;
            --correct-item-bg: #4CAF50;
            --correct-item-hover: #45a049;
            --button-text: #0a0c0a;
            --button-text-hover: #ffffff;
        }

        body.dark-mode {
            --bg-color: #333333;
            --text-color: #ffffff;
            --nav-bg: #222222;
            --sidebar-bg: #2c2c2c;
            --selected-item: #b1a3a3;
            --selected-text: #0a0a0a;
            --border-color: #444444;
            --hover-color: #66b0ff;
            --secondary-bg-color: #444444;
            --correct-item-bg: #4CAF50;
            --correct-item-hover: #45a049;
            --button-text: #0a0c0a;
            --button-text-hover: #ffffff;
        }

        body {
            font-family: Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        hr {
            border: 1px solid var(--border-color);
        }

        .sub-heading {
            font-style: italic;
            font-weight: bold;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--nav-bg);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .left-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }


        .right-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }


        .burger-menu {
            cursor: pointer;
            width: 30px;
            height: 24px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .burger-bar {
            width: 100%;
            height: 3px;
            background-color: var(--text-color);
            transition: 0.3s;
        }

        .help-menu,
        .settings-menu {
            cursor: pointer;
            width: 30px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-menu i,
        .settings-menu i {
            font-size: 24px;
            color: var(--text-color);
        }

        .title {
            font-size: 1.5rem;
            font-weight: bold;
            text-wrap: wrap;
            width: 50%;
            text-align: center;
        }

        .sidebar {
            position: fixed;
            top: 0;
            height: 100vh;
            width: 250px;
            background-color: var(--sidebar-bg);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
            z-index: 1000;
            padding: 1rem;
            color: var(--text-color);
            overflow: auto;
        }

        .left-sidebar {
            left: -250px;
        }

        .help-sidebar {
            left: -300px;
            width: 300px;
        }

        .right-sidebar {
            right: -250px;
        }

        .left-sidebar.active,
        .help-sidebar.active {
            left: 0;
        }

        .right-sidebar.active {
            right: 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 999;
        }

        .overlay.active {
            display: block;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .close-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            color: var(--text-color);
        }

        .menu-items {
            list-style: none;
        }

        .menu-items li {
            padding: 0.5rem 0;
            cursor: pointer;
        }

        .menu-items li:hover {
            color: var(--hover-color);
        }

        .content {
            flex: 1;
            padding-left: 2rem;
            padding-right: 2rem;
            background-color: var(--bg-color);
        }

        .footer {
            background-color: var(--nav-bg);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Toggle Switch Styles */
        .toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1rem 0;
            padding: 0.5rem;
            border-radius: 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #2196F3;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .help-content {
            padding: 1rem;
            line-height: 1.6;
        }

        .grid-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            touch-action: none;
        }

        .grid-row {
            border: 1px solid #dee2e6;
            margin-bottom: 10px;
            padding: 1px;
            background-color: var(--bg-color);
            min-height: 62px;
            transition: background-color 0.3s;
            position: relative;
            display: flex;
        }

        .grid-item {
            border: 1px solid #dee2e6;
            padding: 12px;
            margin: 1%;
            cursor: move;
            user-select: none;
            -webkit-user-select: none;
            height: 62px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-color);
            font-size: 24px;
            font-weight: bold;
            transition: background-color 0.3s;
            flex: 0 0 23%;
            touch-action: none;
        }

        .grid-item-3-3 {
            flex: 0 0 31%;
        }

        .grid-item-4-4 {
            flex: 0 0 23%;
        }


        .grid-item.correct {
            background-color: var(--correct-item-bg);
            color: var(--button-text);
        }

        .grid-item.selected {
            background-color: var(--selected-item);
            color: var(--selected-text);
        }

        .grid-item.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            max-width: 600px;
            margin: 20px auto;
            height: 50px;
        }

        .custom-button {
            width: 100%;
            font-size: 24px;
            font-weight: bold;

        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 400px;
            z-index: 1001;
            background-color: var(--sidebar-bg);
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--correct-item-bg);
        }

        .modal-stats {
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
        }

        .countdown {
            font-size: 18px;
            margin: 15px 0;
            color: var(--text-color);
            min-width: 50%;
            text-align: right;
            border-right: 1px #0a0a0a;
            font-weight: bold;
        }

        .model-row {
            display: flex;
            width: 100%;
        }

        .share-button {
            background-color: var(--correct-item-bg);
            color: var(--button-text);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: background-color 0.3s;
        }

        .reshare-button {
            width: 40%;
            font-size: 24px;
            font-weight: bold;
            background-color: var(--correct-item-bg);
            color: var(--button-text);
            border: none;
            padding: 5px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s;
        }

        .reshare-button:hover {
            background-color: var(--correct-item-hover, #45a049);
            color: var(--hover-color-hover);
        }

        .share-button:hover {
            background-color: var(--correct-item-hover, #45a049);
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            color: var(--text-color);
        }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px 0;
        }

        h1 {
            font-weight: 700;
            font-size: 16px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 10px;
        }

        #statistics {
            display: flex;
        }

        .statistic-container {
            flex: 1;
        }

        .statistic-container .statistic {
            font-size: 36px;
            font-weight: 400;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            letter-spacing: 0.05em;
        }


        .statistic-container .label {
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="left-section">
            <div class="burger-menu" onclick="toggleMenu('left')">
                <div class="burger-bar"></div>
                <div class="burger-bar"></div>
                <div class="burger-bar"></div>
            </div>
            <div class="help-menu" onclick="toggleMenu('help')">
                <i class="fas fa-question-circle"></i>
            </div>
        </div>
        <div class="title"><span id="gridSize">3x3</span>&nbsp;हिन्दी शब्द रचना</div>
        <div class="right-section">
            <div id="divStats" onclick="showWinModal()"> <svg xmlns="http://www.w3.org/2000/svg" height="24"
                    viewBox="0 0 24 24" width="24">
                    <path fill="var(--text-color)"
                        d="M16,11V3H8v6H2v12h20V11H16z M10,5h4v14h-4V5z M4,11h4v8H4V11z M20,19h-4v-6h4V19z"></path>
                </svg>
            </div>
            <div class="settings-menu" onclick="toggleMenu('right')">
                <i class="fas fa-cog"></i>
            </div>
        </div>
    </div>

    <div class="overlay" onclick="closeAllMenus()"></div>

    <div class="sidebar left-sidebar">
        <div class="sidebar-header">
            <h3>Menu</h3>
            <button class="close-button" onclick="toggleMenu('left')">&times;</button>
        </div>
        <div>
            <span class="sub-heading">Related Apps:</span><br>
            <div style="padding-left: 20px;">
                <ul>
                    <li><a href="https://kavishavi.github.io/hinglishwordle/" target="_blank">Hindi Wordle - By Rahul
                            Upadhyaya</a></li>
                    <li><a href="https://tomanishp.github.io/matrix" target="_blank">Classic 4x4 Grid Puzzle</a></li>
                    <li><a href="https://tomanishp.github.io/hindimatra" target="_blank">Hindi Matra Checking Tool</a>
                    </li>
                </ul>
            </div>
        </div>
        <div>
            <hr />
            <span class="sub-heading">Acknowledgement:</span><br>
            <div style="padding-left: 20px;">
                <ul>
                    <li><span>Rahul Upadhyaya, Seattle</span></li>
                </ul>

            </div>
        </div>
    </div>

    <div class="sidebar help-sidebar">
        <div class="sidebar-header">
            <h3>Help</h3>
            <button class="close-button" onclick="toggleMenu('help')">&times;</button>
        </div>
        <div class="help-content">
            <div>
                <div id="enH">
                    <p>
                        हिन्दी के&nbsp;<span id="gridHindi">चार</span>&nbsp;शब्द दिये गयें हैं जिनके अक्षरों के क्रम बदल
                        दिये गए हैं। अक्षरों को सही क्रम में लाने के लिए पहले अक्षर के डब्बे को टच करें फिर दूसरे अक्षर
                        के डब्बे को टच करें। जब
                        कोई शब्द पूरा हो जाएगा तो उसका रंग हरा हो जाएगा और फिर उसके अक्षर स्थिर हो जाएंगे।
                    </p>
                </div>
                <div>&nbsp;</div>
                <div id="enD">
                    <p>
                        Find the&nbsp;<span id="gridEng">four</span>&nbsp;Hindi words hidden in this puzzle by swaping
                        letters around. Click on the first
                        box to
                        mark it for swapping then click another box to swap letters between them. When a correct word is
                        arranged in any row then boxes will be marked as green and locked. Continue to find rest of the
                        words.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar right-sidebar">
        <div class="sidebar-header">
            <h3>Settings</h3>
            <button class="close-button" onclick="toggleMenu('right')">&times;</button>
        </div>
        <div class="toggle-container">
            <span>डार्क मोड</span>
            <label class="switch">
                <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                <span class="slider"></span>
            </label>
        </div>
        <div class="toggle-container">
            <span>3 अक्षर वाले शब्द</span>
            <label class="switch">
                <input type="checkbox" id="threeModeToggle" onchange="toggleThreeMode()">
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <div class="content">
        <div class="grid-container" id="grid"></div>
        <div class="text-center mt-3 button-container" style="vertical-align: middle;">
            <span style="margin: auto;">Steps:&nbsp;<span id="movesCounter">0</span></span>
            <button style="display: none;" class="btn btn-secondary custom-button" id="resetBtn">Reset | नए
                शब्द</button>
        </div>
    </div>

    <!-- Add this HTML to your page -->
    <div id="winModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeWinModal()">×</span>
            <div class="modal-header">Statistics <span id="gridSizeDisplay">4x4</span></div>
            <div class="model-row" style="display: block;">
                <div id="statistics">

                    <div class="statistic-container">
                        <div class="statistic" id="playCount">1</div>
                        <div class="label">Played</div>
                    </div>

                    <div class="statistic-container">
                        <div class="statistic" id="winCount">100</div>
                        <div class="label">Win %</div>
                    </div>

                    <div class="statistic-container">
                        <div class="statistic" id="playStreak">1</div>
                        <div class="label">Current Streak</div>
                    </div>

                    <div class="statistic-container">
                        <div class="statistic" id="maxStreak">1</div>
                        <div class="label">Max Streak</div>
                    </div>
                </div>
                <hr size="1" />
            </div>
            <div class="modal-row">
                <p id="pWin" style="display: none;">आपने <span id="moveCount1">0</span> चाल में सुलझा लिया!</p>
                <p id="pPlay">अब तक <span id="moveCount2">0</span> चालें हो गई हैं!</p>
            </div>
            <hr size="1" />
            <div class="model-row">
                <div class="countdown">
                    नए शब्द: <span id="countdownTimer">00:00:00</span>
                </div>
                <div style="min-width: 50%; padding-left: 10px; margin: auto;" id="rowShare">
                    <button class="share-button" style="width: 90%;" id="btnShare" onclick="shareResult()">
                        साझा करें
                    </button>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <p>&copy; 2024 Manish Pandey. All rights reserved.</p>
    </footer>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="wordbank.js"></script>
    <script src="grid-handler.js"></script>
    <script>

        function toggleMenu(side) {
            const sidebar = document.querySelector(`.${side}-sidebar`);
            const overlay = document.querySelector('.overlay');

            // Close other menus if open
            const sidebars = document.querySelectorAll('.sidebar');
            sidebars.forEach(sb => {
                if (sb !== sidebar) {
                    sb.classList.remove('active');
                }
            });

            // Toggle current menu
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeAllMenus() {
            const sidebars = document.querySelectorAll('.sidebar');
            const overlay = document.querySelector('.overlay');

            sidebars.forEach(sidebar => {
                sidebar.classList.remove('active');
            });
            overlay.classList.remove('active');
        }

        function toggleDarkMode() {
            const darkModeEnabled = document.getElementById('darkModeToggle').checked;
            document.body.classList.toggle('dark-mode', darkModeEnabled);
            setValue('darkMode', darkModeEnabled);
            //console.log('Dark Mode:', darkModeEnabled);
        }

        function toggleThreeMode() {
            const threeModeEnabled = document.getElementById('threeModeToggle').checked;
            setValue('threeMode', threeModeEnabled);
            //console.log('three Mode:', threeModeEnabled);

            gridN = threeModeEnabled ? 3 : 4;
            updateStats();
            initializePuzzle();
        }

        // Initialize toggles from cookies
        window.onload = function () {
            initializeFromCookies();
        }

        function readGridParam() {

            let paramVal = 0;
            try {
                const params = window.location.search.split('&');
                params.forEach(element => {
                    if (element.endsWith('q=3')) {
                        paramVal = 3;
                    } else if (element.endsWith('q=4')) {
                        paramVal = 4;
                    }
                });
            } catch (error) {
                // do nothing 
            }

            return paramVal;
        }

        function initializeFromCookies() {

            if (!(getValue('resetKey', '') == resetKey)) {
                resetAllData();
                setValue('resetKey', resetKey);
            }

            // Read cookie values
            let darkMode = getValue('darkMode', 'false') === 'true';
            let threeMode = getValue('threeMode', 'false') === 'true';

            // Set toggle switches
            const darkModeToggle = document.getElementById('darkModeToggle');
            const threeModeToggle = document.getElementById('threeModeToggle');

            if (darkModeToggle) {
                darkModeToggle.checked = darkMode;
            }

            // check query parameter for short link 
            const gridParam = readGridParam();
            if (gridParam > 0) {

                threeMode = gridParam == 3 ? true : false;
            }

            if (threeModeToggle) {
                threeModeToggle.checked = threeMode;
            }


            gridN = threeMode ? 3 : 4;

            updateStats()

            // Apply dark mode if enabled
            if (darkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }

            initializePuzzle();

            /*
            // Log the initial states (for debugging)
            console.log('Initial Settings:', {
                darkMode: darkMode,
                threeMode: threeMode
            });

            */
        }

        function updateStats() {
            const lastPlayed = getValue('lastPlayed' + gridN, '');
            playCount = getValue('playCount' + gridN, 0);
            winCount = getValue('winCount' + gridN, 0);
            streakCount = getValue('streakCount' + gridN, 0);
            streakMax = getValue('streakMax' + gridN, 0);

            document.getElementById('playCount').textContent = playCount;
            if (winCount == 0) {
                document.getElementById('winCount').textContent = '0%';
            }
            else {
                document.getElementById('winCount').textContent = `${(winCount * 100 / playCount)}%`;
            }
            document.getElementById('playStreak').textContent = streakCount;
            document.getElementById('maxStreak').textContent = streakMax;

            if (lastPlayed != today) {
                playCount++;
                setValue('lastPlayed' + gridN, today);
                setValue('playCount' + gridN, playCount);
                setValue('userGrid' + gridN, '');
                setValue('orgGrid' + gridN, '');
                setValue('movesCounter' + gridN, 0);
            }

        }

        function showWinModal() {
            const modal = document.getElementById('winModal');
            document.getElementById('moveCount1').textContent = movesCounter;
            document.getElementById('gridSizeDisplay').textContent = `${gridN}x${gridN}`;
            document.getElementById('moveCount2').textContent = movesCounter;
            modal.style.display = 'block';
            updateCountdown();
            // Start countdown update interval
            setInterval(updateCountdown, 1000);
        }

        function closeWinModal() {
            document.getElementById('winModal').style.display = 'none';
        }

        function updateCountdown() {
            const now = new Date();
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);

            const diff = midnight - now;

            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('countdownTimer').textContent = timeString;
        }

        async function shareResult() {
            const dateString = new Date().toLocaleDateString();
            const shareText = `🧩 हिन्दी शब्द रचना ${gridN}x${gridN}\n` +
                `चाल: ${movesCounter}\n` +
                `दिनाँक: ${dateString}\n\n` +
                `आप भी खेल कर देखें! 🎮\n` +
                `bit.ly/hindi${gridN}x${gridN}`
                ;

            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Hindi Matrix Puzzle',
                        text: shareText
                    });
                } catch (err) {
                    fallbackShare(shareText);
                }
            } else {
                fallbackShare(shareText);
            }
        }

        function fallbackShare(text) {
            // Create temporary textarea
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);

            // Select and copy text
            textarea.select();
            document.execCommand('copy');

            // Remove temporary textarea
            document.body.removeChild(textarea);

            // Show feedback
            alert('Result copied to clipboard!');
        }

    </script>
</body>

</html>
