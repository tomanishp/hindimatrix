<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4x4 Alphabet Grid</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .grid-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            touch-action: none;
            /* Prevents default touch behaviors */
        }

        .grid-row {
            border: 1px solid #dee2e6;
            margin-bottom: 10px;
            padding: 2px;
            background-color: #f8f9fa;
            min-height: 100px;
            transition: background-color 0.3s ease-in-out;
            position: relative;
            display: flex;
        }

        .grid-item {
            border: 1px solid #dee2e6;
            padding: 20px;
            margin: 1%;
            cursor: move;
            user-select: none;
            -webkit-user-select: none;
            /* Safari */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* IE10+/Edge */
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            font-size: 24px;
            font-weight: bold;
            transition: background-color 0.3s ease-in-out;
            flex: 0 0 23%;
            touch-action: none;
        }

        .grid-item.correct {
            background-color: #98FB98;
        }

        .grid-item.dragging {
            opacity: 0.5;
            z-index: 1000;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        .controls .btn {
            margin: 0 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="text-primary text-center">4x4 Hindi Words</h2>
        <hr size="1" />
        <p><strong><span id="sClick">Steps: 0</span></strong></p>
        <hr size="1" />
        <div class="grid-container">
            <div id="grid"></div>
        </div>
        <div class="controls">
            <button class="btn btn-primary" style="display: none;" id="shuffleBtn">Shuffle</button>
            <button class="btn btn-primary" id="resetBtn">Reset/ नया क्रम</button>
        </div>
        <hr size="1" />
        <div id="enD">
            <p>
                <strong>How to play:&nbsp;</strong>You have to guess 4 hindi wrods correctly. Drag and drop box to
                arrange them in right order. Words can be in any row but then have to be correct word. If same letter is
                in multiple words, try swapping the letter if they are not accepted.
            </p>
        </div>
        <div id="enH">
            <p>
                <strong>कैसे खेलें:&nbsp;</strong>यह चार अक्षर के चार शब्द दिये गए हैं। आप किसी भी डब्बे को उठाकर उसकी
                जगह बदल सकते हैं। यदि एक ही अक्षर दो या अधिक बार है तो संभव है आपको अलग अक्षरों को लगाना पड़े क्योंकि एक
                अक्षर एक ही शब्द से जुड़ा है।
            </p>
        </div>
        <hr size="1" />
        <div style="text-align: center;">(c) Manish Pandey 2024 <a href="mailto:tomanishp@gmail.com">Send feedback/
                सुझाव भेजें</a></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let iClicks = 0;
            let grid = document.getElementById('grid');
            let originalSequence = [];
            let items = [];
            let draggedItem = null;
            let touchStartX = 0;
            let touchStartY = 0;

            function createGrid() {
                iClicks = 0;
                grid.innerHTML = '';
                originalSequence = getRandomWords().join('').split('');
                items = [...originalSequence];

                for (let i = 0; i < 4; i++) {
                    const row = document.createElement('div');
                    row.className = 'grid-row';

                    for (let j = 0; j < 4; j++) {
                        const item = document.createElement('div');
                        item.className = 'grid-item';
                        item.setAttribute('draggable', 'true');
                        item.textContent = items[i * 4 + j];
                        row.appendChild(item);
                    }

                    grid.appendChild(row);
                }
                shuffleGrid();
                checkOrder();
            }

            function initializeEventListeners() {
                // Mouse events
                grid.addEventListener('dragstart', handleDragStart);
                grid.addEventListener('dragend', handleDragEnd);
                grid.addEventListener('dragover', handleDragOver);
                grid.addEventListener('drop', handleDrop);

                // Touch events
                grid.addEventListener('touchstart', handleTouchStart, { passive: false });
                grid.addEventListener('touchmove', handleTouchMove, { passive: false });
                grid.addEventListener('touchend', handleTouchEnd);
            }

            function handleDragStart(e) {
                if (e.target.classList.contains('grid-item')) {
                    draggedItem = e.target;
                    e.target.classList.add('dragging');
                }
            }

            function handleDragEnd(e) {
                if (e.target.classList.contains('grid-item')) {
                    e.target.classList.remove('dragging');
                    iClicks++;
                }
                checkOrder();
            }

            function handleDragOver(e) {
                e.preventDefault();
                handleItemMovement(e.target.closest('.grid-item'));
            }

            function handleDrop(e) {
                e.preventDefault();
                handleItemMovement(e.target.closest('.grid-item'));
                draggedItem = null;
            }

            function handleTouchStart(e) {
                if (e.target.classList.contains('grid-item')) {
                    e.preventDefault();
                    draggedItem = e.target;
                    draggedItem.classList.add('dragging');

                    const touch = e.touches[0];
                    touchStartX = touch.clientX - draggedItem.offsetLeft;
                    touchStartY = touch.clientY - draggedItem.offsetTop;

                    // Store original position
                    draggedItem.style.position = 'absolute';
                    draggedItem.style.zIndex = '1000';
                }
            }

            function handleTouchMove(e) {
                if (draggedItem) {
                    e.preventDefault();
                    const touch = e.touches[0];

                    draggedItem.style.left = `${touch.clientX - touchStartX}px`;
                    draggedItem.style.top = `${touch.clientY - touchStartY}px`;

                    // Find the element under the touch point
                    const touchElement = document.elementFromPoint(touch.clientX, touch.clientY);
                    const targetItem = touchElement?.closest('.grid-item');
                    if (targetItem && targetItem !== draggedItem) {
                        handleItemMovement(targetItem);
                    }
                }
            }

            function handleTouchEnd(e) {
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem.style.position = '';
                    draggedItem.style.left = '';
                    draggedItem.style.top = '';
                    draggedItem.style.zIndex = '';
                    draggedItem = null;
                    checkOrder();
                }
            }

            function handleItemMovement(targetItem) {
                if (targetItem && draggedItem && targetItem !== draggedItem) {
                    const items = [...document.querySelectorAll('.grid-item')];
                    const draggingIndex = items.indexOf(draggedItem);
                    const targetIndex = items.indexOf(targetItem);

                    if (targetIndex > draggingIndex) {
                        targetItem.parentElement.insertBefore(draggedItem, targetItem.nextSibling);
                    } else {
                        targetItem.parentElement.insertBefore(draggedItem, targetItem);
                    }

                    // Rebalance rows
                    const rows = document.querySelectorAll('.grid-row');
                    rows.forEach(row => {
                        if (row.children.length > 4) {
                            const lastItem = row.lastElementChild;
                            const targetRow = Array.from(rows).find(r => r.children.length < 4);
                            if (targetRow) {
                                targetRow.appendChild(lastItem);
                            }
                        }
                    });
                }
            }

            function shuffleGrid() {
                document.querySelectorAll('.grid-item').forEach(item => {
                    item.classList.remove('correct');
                });

                const allItems = [...document.querySelectorAll('.grid-item')];
                const shuffledItems = allItems.sort(() => Math.random() - 0.5);

                document.querySelectorAll('.grid-row').forEach((row, rowIndex) => {
                    row.innerHTML = '';
                    for (let i = 0; i < 4; i++) {
                        row.appendChild(shuffledItems[rowIndex * 4 + i]);
                    }
                });
                checkOrder();
            }

            function checkOrder() {
                const items = document.querySelectorAll('.grid-item');
                const values = Array.from(items).map(item => item.textContent);

                items.forEach(item => item.classList.remove('correct'));

                for (let i = 0; i < originalSequence.length; i += 4) {
                    const sequenceSet = originalSequence.slice(i, i + 4);

                    for (let j = 0; j <= 12; j++) {
                        const currentSet = values.slice(j, j + 4);

                        if (currentSet.length === 4 &&
                            currentSet.every((val, index) => val === sequenceSet[index])) {
                            for (let k = 0; k < 4; k++) {
                                items[j + k].classList.add('correct');
                            }
                        }
                    }
                }

                // Update steps
                document.getElementById("sClick").innerText = 'Steps: ' + iClicks;
            }

            function resetGrid() {
                const oldGrid = document.getElementById('grid');
                const newGrid = document.createElement('div');
                newGrid.id = 'grid';
                oldGrid.parentNode.replaceChild(newGrid, oldGrid);
                grid = newGrid;
                initializeEventListeners();
                createGrid();
            }

            // Initialize grid and add button handlers
            initializeEventListeners();
            createGrid();

            document.getElementById('shuffleBtn').addEventListener('click', shuffleGrid);
            document.getElementById('resetBtn').addEventListener('click', resetGrid);
        });
    </script>
    <script src="wordbank.js"></script>
</body>

</html>
